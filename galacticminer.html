<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galactic Miner | HW Development</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Rubik:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4CAF50;
            --secondary: #2196F3;
            --accent: #FFC107;
            --dark: #1A1A1A;
            --light: #F5F5F5;
            --danger: #F44336;
            --space: #0A0E17;
            --mineral: #9C27B0;
            --fuel: #FF9800;
            --discord: #5865F2;
            --itchio: #FA5C5C;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: var(--light);
            font-family: 'Rubik', sans-serif;
            overflow: hidden;
            padding: 20px;
        }
        
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        #main-menu {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            background: rgba(26, 26, 26, 0.9);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 10;
            position: relative;
            max-width: 600px;
            width: 100%;
            transition: all 0.5s ease;
        }
        
        h1 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
            color: var(--accent);
            font-family: 'Press Start 2P', cursive;
            text-shadow: 3px 3px 0 var(--secondary);
            letter-spacing: 2px;
        }
        
        p {
            margin-bottom: 2rem;
            line-height: 1.6;
        }
        
        .menu-btn {
            padding: 15px 30px;
            font-size: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 50px;
            margin: 10px 0;
            width: 100%;
            max-width: 250px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
            font-family: 'Press Start 2P', cursive;
        }
        
        .menu-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 6px 0 rgba(0, 0, 0, 0.2);
        }
        
        .menu-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 rgba(0, 0, 0, 0.2);
        }
        
        #game-container {
            display: none;
            width: 100%;
            max-width: 750px;
            margin: 0 auto;
            position: relative;
        }
        
        canvas {
            background: var(--space);
            display: block;
            border: 5px solid var(--accent);
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin: 0 auto;
            width: 100%;
            max-width: 800px;
            height: auto;
            aspect-ratio: 4/3;
        }
        
        #game-ui {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            background: rgba(26, 26, 26, 0.9);
            padding: 10px;
            border-radius: 10px;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.7rem;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .resource {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .resource-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
        }
        
        #minerals-icon {
            background: var(--mineral);
        }
        
        #fuel-icon {
            background: var(--fuel);
        }
        
        #credits-icon {
            background: var(--accent);
        }
        
        #planet-info {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            text-align: center;
            font-size: 0.8rem;
        }
        
        #upgrade-panel {
            display: none;
            position: absolute;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(26, 26, 26, 0.95);
            padding: 15px;
            border-radius: 15px;
            border: 3px solid var(--accent);
            z-index: 100;
            max-width: 90%;
            width: 435px;
        }
        
        .upgrade-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.7rem;
        }
        
        .upgrade-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.6rem;
        }
        
        #event-notification {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 16px;
            border-radius: 5px;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.7rem;
            color: var(--accent);
            display: none;
            z-index: 50;
        }
        
        #game-over {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }
        
        #game-over h2 {
            font-size: 2rem;
            color: var(--danger);
            margin-bottom: 15px;
            font-family: 'Press Start 2P', cursive;
            text-shadow: 3px 3px 0 #000;
        }
        
        #final-score {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--accent);
        }
        
        /* Social Buttons Styles */
        .social-btn {
            position: fixed;
            bottom: 10px;
            color: white;
            padding: 8px 12px;
            border-radius: 50px;
            font-family: 'Rubik', sans-serif;
            font-weight: bold;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            z-index: 10;
            font-size: 0.8rem;
        }
        
        #discord-btn {
            left: 10px;
            background: var(--discord);
        }
        
        #discord-btn:hover {
            background: #4752C4;
        }
        
        #itchio-btn {
            left: 120px;
            background: var(--itchio);
        }
        
        #itchio-btn:hover {
            background: #E84C4C;
        }
        
        .social-icon {
            width: 16px;
            height: 16px;
        }
        
        #info-box {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(26, 26, 26, 0.7);
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 0.6rem;
            max-width: 200px;
            text-align: center;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        #info-content {
            display: none;
            position: fixed;
            bottom: 40px;
            right: 10px;
            background: rgba(26, 26, 26, 0.9);
            padding: 12px;
            border-radius: 10px;
            max-width: 200px;
            font-size: 0.6rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        @media (max-width: 600px) {
            h1 {
                font-size: 1.5rem;
            }
            
            .menu-btn {
                padding: 12px 20px;
                font-size: 0.8rem;
            }
            
            #game-ui {
                font-size: 0.6rem;
                padding: 8px;
            }
            
            .resource-icon {
                width: 12px;
                height: 12px;
            }
            
            #upgrade-panel {
                width: 95%;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="main-menu">
        <h1>GALACTIC MINER</h1>
        <p>Mine asteroids, upgrade your ship, and explore the galaxy!</p>
        <button class="menu-btn" id="startGameBtn">START GAME</button>
        <button class="menu-btn" id="howToPlayBtn">HOW TO PLAY</button>
        <button class="menu-btn" id="backToHubBtn">BACK TO HUB</button>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div id="game-ui">
            <div class="resource">
                <div id="minerals-icon" class="resource-icon"></div>
                <span id="minerals">0</span>
            </div>
            <div class="resource">
                <div id="fuel-icon" class="resource-icon"></div>
                <span id="fuel">100</span>
            </div>
            <div class="resource">
                <div id="credits-icon" class="resource-icon"></div>
                <span id="credits">500</span>
            </div>
            <button id="travelBtn" class="menu-btn" style="padding: 6px 12px; font-size: 0.6rem; margin: 0;">TRAVEL</button>
            <button id="upgradeBtn" class="menu-btn" style="padding: 6px 12px; font-size: 0.6rem; margin: 0;">UPGRADES</button>
        </div>
        
        <div id="planet-info">
            <h3 id="planet-name">STARTING PLANET</h3>
            <p id="planet-desc">Mine asteroids to collect minerals and fuel</p>
        </div>
        
        <div id="event-notification"></div>
        
        <div id="upgrade-panel">
            <h2>SHIP UPGRADES</h2>
            <div class="upgrade-item">
                <div>
                    <h3>Mining Laser</h3>
                    <p>Increases mining speed</p>
                    <p id="laser-level">Level: 1</p>
                </div>
                <button class="upgrade-btn" id="upgrade-laser">50 CR</button>
            </div>
            <div class="upgrade-item">
                <div>
                    <h3>Fuel Tank</h3>
                    <p>Increases maximum fuel</p>
                    <p id="tank-level">Level: 1</p>
                </div>
                <button class="upgrade-btn" id="upgrade-tank">50 CR</button>
            </div>
            <div class="upgrade-item">
                <div>
                    <h3>Cargo Hold</h3>
                    <p>Increases mineral capacity</p>
                    <p id="cargo-level">Level: 1</p>
                </div>
                <button class="upgrade-btn" id="upgrade-cargo">50 CR</button>
            </div>
            <div class="upgrade-item">
                <div>
                    <h3>Thrusters</h3>
                    <p>Increases ship speed</p>
                    <p id="thruster-level">Level: 1</p>
                </div>
                <button class="upgrade-btn" id="upgrade-thruster">50 CR</button>
            </div>
            <button id="closeUpgrades" class="menu-btn" style="margin-top: 15px; padding: 8px;">CLOSE</button>
        </div>
        
        <div id="game-over">
            <h2>GAME OVER</h2>
            <div id="final-score">Score: 0</div>
            <div>
                <button class="menu-btn" id="restartBtn">PLAY AGAIN</button>
                <button class="menu-btn" id="menuBtn">MAIN MENU</button>
            </div>
        </div>
    </div>

    <!-- Social Buttons -->
    <a id="discord-btn" class="social-btn" href="https://discord.gg/8CYKQMz8" target="_blank">
        <svg class="social-icon" viewBox="0 0 127.14 96.36" fill="currentColor">
            <path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.42,68.42,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/>
        </svg>
        Discord
    </a>

    <a id="itchio-btn" class="social-btn" href="https://hw-development.itch.io" target="_blank">
        <svg class="social-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M21.3 13.6c0 1.2-.7 2.3-1.8 2.8-1 .5-2.2.3-3-.5l-2.2-2.2c-.4-.4-.4-1 0-1.4.4-.4 1-.4 1.4 0l2.2 2.2c.3.3.8.3 1.1.1.3-.2.5-.6.4-1-.1-.4-.5-.7-.9-.7H3.5c-.6 0-1-.4-1-1s.4-1 1-1h16.8c1.3 0 2.5.8 3 2 .5 1.2.3 2.5-.5 3.4-.8.8-2 1.1-3.1.8-1.1-.3-2-1.2-2.3-2.3-.3-1.1 0-2.3.8-3.1l2.2-2.2c.4-.4 1-.4 1.4 0.4.4.4 1 0 1.4l-2.2 2.2c-.8.8-.9 2-.4 3z"/>
        </svg>
        Itch.io
    </a>

    <!-- Info box -->
    <div id="info-box" onclick="toggleInfo()">About</div>
    <div id="info-content">
        <h3>Information</h3>
        <p>----------------------------------------</p>
        <p><strong>Author:</strong> HW Development™</p>
        <p><strong>Developer:</strong> HenkW</p>
        <p><strong>Contact:</strong> hwdevelopment1@gmail.com</p>
        <p>If you have suggestions or bug reports, contact us please!</p>
        <p>----------------------------------------</p>
    </div>

    <script>
        // Game elements
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        
        // Adjust canvas size for better mobile experience
        function resizeCanvas() {
            const maxWidth = Math.min(800, window.innerWidth - 40);
            const ratio = 3/4; // height/width ratio
            canvas.width = maxWidth;
            canvas.height = maxWidth * ratio;
        }
        
        // Game state
        const gameState = {
            minerals: 0,
            fuel: 100,
            credits: 500,
            maxFuel: 100,
            maxMinerals: 100,
            miningSpeed: 1,
            shipSpeed: 3,
            currentPlanet: 0,
            gameOver: false,
            upgrades: {
                laser: 1,
                tank: 1,
                cargo: 1,
                thruster: 1
            },
            upgradeCosts: {
                laser: 50,
                tank: 50,
                cargo: 50,
                thruster: 50
            }
        };
        
        // Planets data
        const planets = [
            {
                name: "Asteroid Belt",
                desc: "Rich in common minerals",
                color: "#795548",
                mineralValue: 1,
                fuelChance: 0.3
            },
            {
                name: "Ice Planet",
                desc: "High fuel deposits, rare minerals",
                color: "#2196F3",
                mineralValue: 2,
                fuelChance: 0.7
            },
            {
                name: "Volcanic World",
                desc: "Dangerous but valuable minerals",
                color: "#F44336",
                mineralValue: 3,
                fuelChance: 0.1
            },
            {
                name: "Crystal Fields",
                desc: "Precious crystal formations",
                color: "#9C27B0",
                mineralValue: 5,
                fuelChance: 0.2
            }
        ];
        
        // Game objects
        let asteroids = [];
        let particles = [];
        let ship = {
            x: 0,
            y: 0,
            width: 30,
            height: 50,
            targetX: 0,
            targetY: 0,
            mining: false,
            miningTarget: null
        };
        
        // Initialize game
        function initGame() {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // Initialize ship position
            ship.x = canvas.width / 2;
            ship.y = canvas.height / 2;
            ship.targetX = ship.x;
            ship.targetY = ship.y;
            
            // Event listeners
            document.getElementById("travelBtn").addEventListener("click", travelToNextPlanet);
            document.getElementById("startGameBtn").addEventListener("click", startGame);
            document.getElementById("howToPlayBtn").addEventListener("click", showInstructions);
            document.getElementById("backToHubBtn").addEventListener("click", () => {
                window.location.href = "index.html";
            });
            
            document.getElementById("upgradeBtn").addEventListener("click", showUpgrades);
            document.getElementById("closeUpgrades").addEventListener("click", hideUpgrades);
            
            // Upgrade buttons
            document.getElementById("upgrade-laser").addEventListener("click", () => upgradeShip('laser'));
            document.getElementById("upgrade-tank").addEventListener("click", () => upgradeShip('tank'));
            document.getElementById("upgrade-cargo").addEventListener("click", () => upgradeShip('cargo'));
            document.getElementById("upgrade-thruster").addEventListener("click", () => upgradeShip('thruster'));
            
            // Game over buttons
            document.getElementById("restartBtn").addEventListener("click", restartGame);
            document.getElementById("menuBtn").addEventListener("click", showMainMenu);
            
            // Info box
            document.getElementById("info-box").addEventListener("click", toggleInfo);
            
            // Mouse/touch controls
            canvas.addEventListener("mousedown", handleClick);
            canvas.addEventListener("touchstart", handleTouch);
            
            // Generate initial asteroids
            generateAsteroids();
            
            // Start game loop
            requestAnimationFrame(gameLoop);
        }
        
        // Start game
        function startGame() {
            document.getElementById("main-menu").style.display = "none";
            document.getElementById("game-container").style.display = "block";
            resetGame();
        }
        
        // Reset game state
        function resetGame() {
            gameState.minerals = 0;
            gameState.fuel = 100;
            gameState.credits = 500;
            gameState.maxFuel = 100;
            gameState.maxMinerals = 100;
            gameState.miningSpeed = 1;
            gameState.shipSpeed = 3;
            gameState.currentPlanet = 0;
            gameState.gameOver = false;
            gameState.upgrades = {
                laser: 1,
                tank: 1,
                cargo: 1,
                thruster: 1
            };
            gameState.upgradeCosts = {
                laser: 50,
                tank: 50,
                cargo: 50,
                thruster: 50
            };
            
            ship.x = canvas.width / 2;
            ship.y = canvas.height / 2;
            ship.targetX = ship.x;
            ship.targetY = ship.y;
            ship.mining = false;
            ship.miningTarget = null;
            
            generateAsteroids();
            updateUI();
            updatePlanetInfo();

            particles = [];

            document.getElementById("game-over").style.display = "none";
        }
        
        // Game loop
        function gameLoop() {
            if (gameState.gameOver) return;
            
            // Clear canvas
            ctx.fillStyle = "#0A0E17";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw stars
            drawStars();
            
            // Update and draw asteroids
            updateAsteroids();
            
            // Update and draw ship
            updateShip();
            drawShip();
            
            // Update and draw particles
            updateParticles();
            
            // Random events
            if (Math.random() < 0.001) {
                triggerRandomEvent();
            }
            
            // Consume fuel over time
            gameState.fuel -= 0.01;
            if (gameState.fuel <= 0) {
                gameOver();
            }
            
            updateUI();
            requestAnimationFrame(gameLoop);
        }
        
        // Draw stars background
        function drawStars() {
            ctx.fillStyle = "white";
            for (let i = 0; i < 100; i++) {
                const x = Math.sin(i * 100) * canvas.width;
                const y = Math.cos(i * 50) * canvas.height;
                const size = Math.random() * 2;
                ctx.fillRect(x, y, size, size);
            }
        }
        
        // Generate asteroids
        function generateAsteroids() {
            asteroids = [];
            const count = 15 + Math.floor(Math.random() * 10);
            
            for (let i = 0; i < count; i++) {
                const size = 20 + Math.random() * 40;
                asteroids.push({
                    x: Math.random() * (canvas.width - size),
                    y: Math.random() * (canvas.height - size),
                    size: size,
                    rotation: Math.random() * Math.PI * 2,
                    rotationSpeed: (Math.random() - 0.5) * 0.02,
                    minerals: Math.floor(size / 8),
                    type: Math.random() < 0.2 ? "fuel" : "mineral"
                });
            }
        }
        
        // Update asteroids
        function updateAsteroids() {
            asteroids.forEach(asteroid => {
                // Draw asteroid
                ctx.save();
                ctx.translate(asteroid.x + asteroid.size/2, asteroid.y + asteroid.size/2);
                ctx.rotate(asteroid.rotation);
                
                if (asteroid.type === "fuel") {
                    ctx.fillStyle = "#FF9800";
                } else {
                    ctx.fillStyle = "#9C27B0";
                }
                
                // Create asteroid shape
                ctx.beginPath();
                for (let i = 0; i < 8; i++) {
                    const angle = (i / 8) * Math.PI * 2;
                    const radius = asteroid.size/2 * (0.7 + Math.random() * 0.3);
                    const x = Math.cos(angle) * radius;
                    const y = Math.sin(angle) * radius;
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                ctx.closePath();
                ctx.fill();
                
                ctx.restore();
                
                // Update rotation
                asteroid.rotation += asteroid.rotationSpeed;
                
                // Mining check
                if (ship.mining && ship.miningTarget && asteroids.includes(ship.miningTarget)) {
                    const dx = ship.x - (asteroid.x + asteroid.size/2);
                    const dy = ship.y - (asteroid.y + asteroid.size/2);
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < asteroid.size/2 + 30) {
                        // Mining progress
                        const miningAmount = gameState.miningSpeed * 0.1;
                        
                        if (asteroid.type === "fuel") {
                            gameState.fuel = Math.min(gameState.maxFuel, gameState.fuel + miningAmount);
                        } else {
                            gameState.minerals = Math.min(gameState.maxMinerals, gameState.minerals + miningAmount);
                        }
                        
                        asteroid.minerals -= miningAmount;
                        
                        // Create mining particles
                        if (Math.random() < 0.3) {
                            particles.push({
                                x: asteroid.x + asteroid.size/2,
                                y: asteroid.y + asteroid.size/2,
                                color: asteroid.type === "fuel" ? "#FF9800" : "#9C27B0",
                                size: 2 + Math.random() * 3,
                                life: 30 + Math.random() * 20,
                                vx: (Math.random() - 0.5) * 2,
                                vy: (Math.random() - 0.5) * 2
                            });
                        }
                        
                        // Asteroid depleted
                        if (asteroid.minerals <= 0) {
                            asteroids.splice(asteroids.indexOf(asteroid), 1);
                            ship.mining = false;
                            ship.miningTarget = null;
                            
                            // Create explosion particles
                            for (let i = 0; i < 15; i++) {
                                particles.push({
                                    x: asteroid.x + asteroid.size/2,
                                    y: asteroid.y + asteroid.size/2,
                                    color: asteroid.type === "fuel" ? "#FF9800" : "#9C27B0",
                                    size: 3 + Math.random() * 4,
                                    life: 40 + Math.random() * 30,
                                    vx: (Math.random() - 0.5) * 4,
                                    vy: (Math.random() - 0.5) * 4
                                });
                            }
                        }
                    }
                }
            });
        }
        
        // Update ship
        function updateShip() {
            // Move toward target
            const dx = ship.targetX - ship.x;
            const dy = ship.targetY - ship.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance > 5) {
                ship.x += (dx / distance) * gameState.shipSpeed;
                ship.y += (dy / distance) * gameState.shipSpeed;
            }
            
            // Consume fuel when moving
            if (distance > 10) {
                gameState.fuel -= 0.02;
            }
        }
        
        // Draw ship
        function drawShip() {
            ctx.save();
            ctx.translate(ship.x, ship.y);
            
            // Calculate angle to target
            const angle = Math.atan2(ship.targetY - ship.y, ship.targetX - ship.x);
            ctx.rotate(angle + Math.PI/2);
            
            // Ship body
            ctx.fillStyle = "#2196F3";
            ctx.beginPath();
            ctx.moveTo(0, -ship.height/2);
            ctx.lineTo(-ship.width/2, ship.height/2);
            ctx.lineTo(ship.width/2, ship.height/2);
            ctx.closePath();
            ctx.fill();
            
            // Ship details
            ctx.fillStyle = "#FFC107";
            ctx.fillRect(-5, -10, 10, 20);
            
            // Engine glow when moving
            const dx = ship.targetX - ship.x;
            const dy = ship.targetY - ship.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance > 10) {
                ctx.fillStyle = "#FF5722";
                ctx.beginPath();
                ctx.moveTo(-10, ship.height/2);
                ctx.lineTo(0, ship.height/2 + 15);
                ctx.lineTo(10, ship.height/2);
                ctx.closePath();
                ctx.fill();
                
                // Exhaust particles
                if (Math.random() < 0.3) {
                    particles.push({
                        x: ship.x - Math.sin(angle) * 25,
                        y: ship.y + Math.cos(angle) * 25,
                        color: "#FF5722",
                        size: 3 + Math.random() * 2,
                        life: 20 + Math.random() * 10,
                        vx: (Math.random() - 0.5) * 2 - Math.sin(angle) * 2,
                        vy: (Math.random() - 0.5) * 2 + Math.cos(angle) * 2
                    });
                }
            }
            
            // Mining laser
            if (ship.mining && ship.miningTarget) {
                ctx.strokeStyle = "#00E5FF";
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(0, 10);
                
                const asteroid = ship.miningTarget;
                const asteroidX = asteroid.x + asteroid.size/2 - ship.x;
                const asteroidY = asteroid.y + asteroid.size/2 - ship.y;
                const asteroidAngle = Math.atan2(asteroidY, asteroidX);
                const asteroidDistance = Math.sqrt(asteroidX * asteroidX + asteroidY * asteroidY);
                
                // Calculate laser end point
                const laserLength = Math.min(asteroidDistance - asteroid.size/2, 200);
                const laserX = Math.cos(asteroidAngle - Math.PI/2) * laserLength;
                const laserY = Math.sin(asteroidAngle - Math.PI/2) * laserLength;
                
                ctx.lineTo(laserX, laserY);
                ctx.stroke();
                
                // Laser particles
                if (Math.random() < 0.5) {
                    particles.push({
                        x: ship.x + laserX * 0.8,
                        y: ship.y + laserY * 0.8,
                        color: "#00E5FF",
                        size: 1 + Math.random() * 2,
                        life: 10 + Math.random() * 5,
                        vx: (Math.random() - 0.5),
                        vy: (Math.random() - 0.5)
                    });
                }
            }
            
            ctx.restore();
        }
        
        // Update particles
        function updateParticles() {
            particles.forEach((particle, index) => {
                particle.x += particle.vx;
                particle.y += particle.vy;
                particle.life--;
                
                if (particle.life <= 0) {
                    particles.splice(index, 1);
                } else {
                    ctx.globalAlpha = particle.life / 50;
                    ctx.fillStyle = particle.color;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.globalAlpha = 1;
                }
            });
        }
        
        // Handle click/touch
        function handleClick(e) {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            handleInput(x, y);
        }
        
        function handleTouch(e) {
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const touch = e.touches[0];
            const x = touch.clientX - rect.left;
            const y = touch.clientY - rect.top;
            
            handleInput(x, y);
        }
        
        function handleInput(x, y) {
            ship.targetX = x;
            ship.targetY = y;
            
            // Check if clicked on asteroid
            ship.mining = false;
            ship.miningTarget = null;
            
            for (const asteroid of asteroids) {
                const dx = x - (asteroid.x + asteroid.size/2);
                const dy = y - (asteroid.y + asteroid.size/2);
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < asteroid.size/2) {
                    ship.mining = true;
                    ship.miningTarget = asteroid;
                    break;
                }
            }
        }
        
        // Update UI
        function updateUI() {
            document.getElementById("minerals").textContent = Math.floor(gameState.minerals);
            document.getElementById("fuel").textContent = Math.floor(gameState.fuel);
            document.getElementById("credits").textContent = Math.floor(gameState.credits);
            
            // Update upgrade buttons
            document.getElementById("laser-level").textContent = `Level: ${gameState.upgrades.laser}`;
            document.getElementById("tank-level").textContent = `Level: ${gameState.upgrades.tank}`;
            document.getElementById("cargo-level").textContent = `Level: ${gameState.upgrades.cargo}`;
            document.getElementById("thruster-level").textContent = `Level: ${gameState.upgrades.thruster}`;
            
            document.getElementById("upgrade-laser").textContent = `${gameState.upgradeCosts.laser} CR`;
            document.getElementById("upgrade-tank").textContent = `${gameState.upgradeCosts.tank} CR`;
            document.getElementById("upgrade-cargo").textContent = `${gameState.upgradeCosts.cargo} CR`;
            document.getElementById("upgrade-thruster").textContent = `${gameState.upgradeCosts.thruster} CR`;
        }
        
        // Update planet info
        function updatePlanetInfo() {
            const planet = planets[gameState.currentPlanet];
            document.getElementById("planet-name").textContent = planet.name;
            document.getElementById("planet-desc").textContent = planet.desc;
        }
        
        // Show upgrades panel
        function showUpgrades() {
            document.getElementById("upgrade-panel").style.display = "block";
        }
        
        // Hide upgrades panel
        function hideUpgrades() {
            document.getElementById("upgrade-panel").style.display = "none";
        }
        
        // Upgrade ship
        function upgradeShip(type) {
            const cost = gameState.upgradeCosts[type];
            
            if (gameState.credits >= cost) {
                gameState.credits -= cost;
                gameState.upgrades[type]++;
                
                // Apply upgrade
                switch(type) {
                    case "laser":
                        gameState.miningSpeed = 1 + gameState.upgrades.laser * 0.5;
                        break;
                    case "tank":
                        gameState.maxFuel = 100 + gameState.upgrades.tank * 50;
                        gameState.fuel = gameState.maxFuel;
                        break;
                    case "cargo":
                        gameState.maxMinerals = 100 + gameState.upgrades.cargo * 50;
                        break;
                    case "thruster":
                        gameState.shipSpeed = 3 + gameState.upgrades.thruster * 0.5;
                        break;
                }
                
                // Increase next cost
                gameState.upgradeCosts[type] = Math.floor(cost * 1.5);
                
                updateUI();
                showNotification(`Upgraded ${type} to level ${gameState.upgrades[type]}!`);
            } else {
                showNotification("Not enough credits!");
            }
        }
        
        // Travel to next planet
        function travelToNextPlanet() {
            if (gameState.fuel < 50) {
                showNotification("Not enough fuel to travel!");
                return;
            }
            
            gameState.fuel -= 50;
            gameState.currentPlanet = (gameState.currentPlanet + 1) % planets.length;
            
            // Sell minerals
            const planet = planets[gameState.currentPlanet];
            const saleValue = Math.floor(gameState.minerals * planet.mineralValue);
            gameState.credits += saleValue;
            gameState.minerals = 0;
            
            // Generate new asteroids
            generateAsteroids();
            updatePlanetInfo();
            
            showNotification(`Traveled to ${planet.name}! Sold minerals for ${saleValue} CR`);
        }
        
        // Random events
        function triggerRandomEvent() {
            const events = [
                {
                    name: "Solar Flare",
                    effect: () => {
                        gameState.fuel -= 20;
                        showNotification("Solar flare! Lost 20 fuel");
                    },
                    chance: 0.6
                },
                {
                    name: "Asteroid Shower",
                    effect: () => {
                        generateAsteroids();
                        showNotification("Asteroid shower! New resources available");
                    },
                    chance: 0.3
                },
                {
                    name: "Fuel Deposit",
                    effect: () => {
                        gameState.fuel += 30;
                        showNotification("Found fuel deposit! +30 fuel");
                    },
                    chance: 0.1
                }
            ];
            
            // Choose random event based on weights
            let random = Math.random();
            let chosenEvent = null;
            
            for (const event of events) {
                if (random < event.chance) {
                    chosenEvent = event;
                    break;
                }
                random -= event.chance;
            }
            
            if (chosenEvent) {
                chosenEvent.effect();
            }
        }
        
        // Show notification
        function showNotification(message) {
            const notification = document.getElementById("event-notification");
            notification.textContent = message;
            notification.style.display = "block";
            
            setTimeout(() => {
                notification.style.display = "none";
            }, 3000);
        }
        
        // Game over
        function gameOver() {
            gameState.gameOver = true;
            document.getElementById("final-score").textContent = `Score: ${Math.floor(gameState.credits)}`;
            document.getElementById("game-over").style.display = "flex";
        }
        
        // Restart game
        function restartGame() {
            resetGame();
            requestAnimationFrame(gameLoop);
        }
        
        // Show main menu
        function showMainMenu() {
            document.getElementById("main-menu").style.display = "flex";
            document.getElementById("game-container").style.display = "none";
        }
        
        // Show instructions
        function showInstructions() {
            const instructions = `
                ⚠️  HOW TO PLAY  ⚠️
                --------------------------------------------------------
                🛸 Click/tap to move your ship.
                ⛏️ Click on asteroids to mine them.
                ⚡ Blue asteroids contain fuel.
                💜 Purple asteroids contain minerals.
                💰 Sell minerals by traveling to new planets.
                🛠️ Upgrade your ship to improve capabilities.
                ⚠️ Watch your fuel - running out ends the game!
                --------------------------------------------------------
                "Good luck sir!"
            `;
            
            alert(instructions);
        }
        
        // Toggle info box
        function toggleInfo() {
            const infoContent = document.getElementById("info-content");
            if (infoContent.style.display === "block") {
                infoContent.style.display = "none";
            } else {
                infoContent.style.display = "block";
            }
        }
        
        // Initialize the game when loaded
        window.addEventListener("load", initGame);
    </script>
</body>
</html>
